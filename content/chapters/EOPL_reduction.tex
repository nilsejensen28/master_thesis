\setchapterpreamble[u]{\margintoc}
\chapter{Reducing \Tarski\ to \EOPL}

In the previous chapter we saw how one can show membership of \Tarski\ in \PPAD\ using the a reduction to \Sperner. We now want to show that the same idea yields a reduction to \EndOfPotentialLine\ which lies in \EOPL. This will requiere a much more careful analysis of the structure of a \Tarski\ instance, and of the induced coloring of the lattice points. We will need to work directly with a special simplical decomposition of the lattice, which we will build to have some desired properties. The final goal will be to show that for a monotone \Tarski\ instance, the induced \EndOfLine\ instance does not contain any cycles. This will be enough to show that the reduction is correct.

\section{Choosing a simplicial decomposition of the lattice --- Freudenthal's Simplical Decomposition}[Freudenthal's Simplical Decomposition]

In the previous chapter we left the choice of a particular simplicial decomposition of the lattice open, as it was not relevant to the reduction. We now want to be more careful and choose a simplicial decomposition, which will help us prove structural results. We first want to discuss what properties we want our simplicial decomposition to have. The first --- and obvious --- property we want our simplicial decomposition to have is that every simplex of the decomposition is contained in exactly one cell of the lattice. This means that we can reduce the question to finding a simplical decomposition of the $d$-dimensional hypercube of length $1$. Also take note, that we do not want to add any vertices, but find a decomposition of the hypercube, that can be described as a set of subsets of the hypercube's vertices.	Finally we want the vertices of a given simplex to be totally ordered, with respect to the partial order defined in \cref{sec:tarski_problem}. This will be crucial for proving important structural results.

Such a decomposition exists, and is known in the litterature as \textit{Freudenthal's simplical decomposition} \sidecite{freudenthal_simplizialzerlegungen_1942}. We will introduce it in a combinatorial way here, and refer the reader to the original paper for a more geometric construction.

\begin{definition}[Freudenthal's Simplicial Decomposition]
    Consider a unit hypercube $[0, 1]^d$ in $\R^d$ and consider $S_d$ the group of all permutations of the dimensions of the hypercube $\{1, \dots, d\}$. For every permutation $\pi \in S_d$, define the simplex $S_{\pi}$ as the convex hull of the vertices:
    \marginnote[10mm]{Here we will use the notation $e_i$ to denote the $i$-th \define{unit vector} in $\R^d$.}
    \begin{align*}
        v_0 & = (0, 0, \dots, 0)                        \\
        v_1 & = v_0 + e_{\pi(1)}                        \\
        v_2 & = v_1 + e_{\pi(2)}                        \\
            & \vdots                                    \\
        v_d & = v_{d-1} + e_{\pi(d)} = (1, 1, \dots, 1)
    \end{align*}
    The set of such simplexes $\mathcal{S} = \set{S_{\pi} : \pi \in S_d}$ is Freudenthal's simplicial decomposition of the hypercube $[0, 1]^d$.
\end{definition}
We want to begin by arguing why this decomposition is well-defined. We begin by showing that every point of the hypercube is contained in at least one simplex of $\mathcal{S}$.
\begin{lemma}
    \label{lem:caracterisation_of_simplices}
    Let $x = (x[1], \dots, x[d]) \in [0, 1]^d$, let $\pi \in S^d$ be the permutation such that $x[\pi(1)] \leq x[\pi(2)] \leq \dots \leq x[\pi(d)]$. Then $x \in S_{\pi}$.
\end{lemma}
\begin{proof}
    We want to show that $x$ is a convex combination of the vertices of $S_{\pi}$. We define the following sequence of real numbers:
    \begin{align*}
        \lambda_0     & = x[\pi(1)]               \\
        \lambda_1     & = x[\pi(2)] - x[\pi(1)]   \\
        \lambda_2     & = x[\pi(3)] - x[\pi(2)]   \\
                      & \vdots                    \\
        \lambda_{d-1} & = x[\pi(d)] - x[\pi(d-1)] \\
        \lambda_d     & = 1 - x[\pi(d)]
    \end{align*}
    Notice that we have $\lambda_i \geq 0$ for all $i$ and $\sum_{i=0}^{d} \lambda_i = 1$, by telescoping the sum. We can now write $x$ as a convex combination of the vertices of $S_{\pi}$ as follows by noticing that $v_i = \sum_{j=0}^{i} e_{\pi(j)}$:
    \begin{align*}
        \sum_{i=0}^{d} \lambda_i v_i & = \sum_{i=0}^{d} \lambda_i \left( \sum_{j=0}^{i} e_{\pi(j)} \right)  = \sum_{i=0}^{d} \sum_{j=1}^{i} \lambda_i e_{\pi(j)}                                \\
                                     & = \sum_{j=1}^{d} \sum_{i=0}^{j} \lambda_i e_{\pi(j)}  = \sum_{j=1}^{d} e_{\pi(j)} \sum_{i=0}^{j} \lambda_i		 = \sum_{j=1}^{d} e_{\pi(j)} x[\pi(j)]		     = x
    \end{align*}
    This shows that $x$ is a convex combination of the vertices of $S_{\pi}$, and thus $x \in S_{\pi}$.
\end{proof}
Next we want to discuss why this really forms a partition of the hypercube. Of course a given point $x$ can be contained in multiple simplexes, but we want to show that this does not happen appart from on the boundary of the simplices.
\begin{lemma}
    Let $S_{\pi} \in \mathcal{S}$ be a simplex. Then the \define{interior} of $S_{\pi}$ is:
    \begin{align*}
        \interior{S_{\pi}} = \set{x \in [0, 1]^d : 0 < x[\pi(1)] < x[\pi(2)] < \dots < x[\pi(d)] < 1}
    \end{align*}
\end{lemma}
\begin{proof}
    The same proof as for \cref{lem:caracterisation_of_simplices}, holds with the added constraint that all $\lambda_i > 0$, this then shows that these points are in the interior of the simplex.
\end{proof}
These two lemma's together show that we have a well-defined simplicial decomposition of the hypercube. We can now use this decomposition to prove some structural results about the lattice points of a \Tarski\ instance. We start by showing that this simplicial decomposition has the desired properties.
\begin{lemma}
    Let $S_{\pi} \in \mathcal{S}$ be a simplex. Then the vertices of $S_{\pi}$ are totally ordered with respect to the partial order defined in \cref{sec:tarski_problem}. In particular we claim that:
    \begin{align*}
        v_0 < v_1 < v_2 < \dots < v_d
    \end{align*}
\end{lemma}
\begin{proof}
    Because this relation is transitive it suffice to show that $v_i < v_{i+1}$ for all $i \in \set{0, \dots, d-1}$. This follows immediately from the construction of the $v_i$ as we have $v_i[j] = v_{i+1}[j]$ for all $j \neq \pi(i+1)$ and $v_i[\pi(i+1)] = v_{i+1}[\pi(i+1)] - 1$.
\end{proof}
This directly implies the following corollary.
\begin{corollary}
    For two vertices $x,y$ of any simplex $S \in \mathcal{S}$, if for any $i \in \set{1, \dots, d}$ we have $x[i] < y[i]$, then $x < y$. In particular $x \not\leq y$ is equivalent to $x > y$.
\end{corollary}
Notice that this is not the case for any two points in the hypercube, as the partial order is not a total order. This is why choosing a simplicial decomposition with this property will be crucial in the following sections.

\section{Properties of the coloring of \Tarski\ instances}[Properties of the coloring]

In this section we want to discuss different properties with the coloring of \Tarski\ instances have. This will be helpful in arguing that the resulting \EndOfLine\ instance does not contain any cycles. We will start with general properties and then move on to properties of sequences of simplices.

\subsection{General properties of the coloring}

\marginnote{Recall that the coloring was given by: \begin{align*}
        c(x) =
        \begin{cases}
            0 & \text{if $x \leq f(x)$}         \\
            1 & \text{else if $x[1] > f(x)[1]$} \\
              & \vdots                          \\
            d & \text{else if $x[d] > f(x)[d]$}
        \end{cases}
    \end{align*}}
In this section we will assume that we are working on a integer lattice $L$, and that for a function $f : L \rightarrow L$, the points have been colored $c : L \rightarrow \set{0, \dots, d}$ as in \cref{sec:tarskistar_to_sperner}. Now we are ready to present a first observation, which will be a helpful stepping stone for more advanced results.

\begin{lemma}
    Assume that $f$ is monotone and that we have $x_i, x_j \in L$, $c(x_i) = i$ and $c(x_j) = j$ for $i, j \in \set{1, \dots, d}$ and $x_i[i] = x_j[i]$, then either:
    \begin{enumerate}
        \item $i \geq j$ or
        \item $i < j$  and $x_i \not\geq x_j$
    \end{enumerate}
\end{lemma}
\begin{proof}
    Assume that $i < j$ and $x_i \geq x_j$. We must then have $f(x_j)[i] \geq x_j[i] = x_i[i] > f(x_i)[i]$. Now by monoticity of $f$ we must have $f(x_i) \geq f(x_j)$, which is not possible if $f(x_j)[i] > f(x_i)[i]$. Hence we must have $x_i \not\geq x_j$. This shows that the lemma holds.
\end{proof}

For vertices of a given simplex we get the following corollary.
\marginnote[10mm]{Notice that if we assume that $x_i$ and $x_j$ are in the same simplex of the simplicial decomposition, then the condition $x_i \not\geq x_j$ is equivalent to $x_i \leq x_j$.}
\begin{corollary}
    Assume that $f$ is monotone and that we have $x_i, x_j \in S$, for some simplex $S\in  \mathcal{S}$. Further assume that $c(x_i) = i$ and $c(x_j) = j$ for $i, j \in \set{1, \dots, d}$ with $i < j$ and that $x_i[i] = x_j[i]$, then $x_i \leq x_j$.
\end{corollary}

\subsection{Properties of sequences of simplices}

Now we want to work with sequences of simplices, and show that the coloring of the vertices of these simplices have some nice properties. We start by defining what we mean by a sequence of simplices. Let $C \subset \{0, \dots, d\}$ be a subset of colors.
\begin{definition}[Valid sequence of simplices]
    A \emph{valid sequence of simplices for colors $C$} is a sequence $\left(S_i\right)_{i=1}^{k}$ of simplices $S_i \in \mathcal{S}$ such that:
    \begin{enumerate}
        \item $S_{i+1} \not\subset \set{S_1, \dots, S_i}$ for all $i \in \set{1, \dots, k-1}$.
        \item $S_i$ and $S_{i+1}$ share a $d-1$-dimensional face $F_i$ for all $i \in \set{1, \dots, k-1}$.
        \item The vertices of $F_i$ are colored only with colors in $C$.
    \end{enumerate}
\end{definition}
These sequences are the objects that latter get reduced to paths in the \EndOfLine\ instance, which is why we want to study them in detail. We define the some more terminology to help us with this.
\begin{definition}[Cycle]
    \marginnote[-10mm]{Note that the empty sequence, and all sequences consisting of a single simplex are cycles.}
    A \emph{cycle of simplices for colors $C$} is a valid sequence $\left(S_i\right)_{i=1}^{k}$ of simplices $S_i \in \mathcal{S}$ for colors $C$ such that $S_{k+1} = S_1$.
\end{definition}
\begin{definition}[Maximal sequence]
    \marginnote[-10mm]{Inuitively we say that a sequence is maximal if we cannot make it longer by adding simplices at the beginning or end.}
    A \emph{maximal sequence of simplices for colors $C$} is a valid sequence $\left(S_i\right)_{i=1}^{k}$ of simplices $S_i \in \mathcal{S}$ for colors $C$ such that:
    \begin{enumerate}
        \item There is no simplex $S_{k+1} \in \mathcal{S}$ such that $\left(S_i\right)_{i=1}^{k+1}$ is a valid sequence.
        \item There is no simplex $S_{0} \in \mathcal{S}$ such that $\left(S_i\right)_{i=0}^{k}$ is a valid sequence.
    \end{enumerate}
\end{definition}
Finally we want to define the sequence of all transitions between simplices in a sequence.
\begin{definition}[Transition sequence]
    The \emph{transition sequence} of a valid sequence $\left(S_i\right)_{i=1}^{k}$ of simplices $S_i \in \mathcal{S}$ is the sequence $\left(F_i\right)_{i=1}^{k-1}$ of $(d-1)$-dimensional faces $F_i = S_i \cap S_{i+1}$.
\end{definition}

We now are ready to study the properties of these sequence in more detail. We now restrict ourselves to the case where $C \subset \{0, \dots, d\}$ contains exactly $d$ colors (i.e.~only one color is left out). Notice that for a valid sequence $\left( S_i \right)_{i=1}^k$ we then have that the transition sequence $\left( F_i \right)_{i=1}^{k-1}$ is a sequence of $(d-1)$-dimensional simplices $S_i$ which are colored with all $d$ colors of $C$. This means that for every $j \in C$ we get a sequence of vertices $(x_i^j)_{i=1}^k$ such that $x_i^j \in F_i$ and $c(x_i^j) = j$. We will now study this special case in more detail.

\begin{lemma}
    Let $S_i$, $F_i$ and $x_j$ be as above. For any $i \in \set{1, \dots, k-1}$ there is exactly one $j \in C$ such that we have $x_i^j \neq x_{i+1}^j$.
\end{lemma}
\begin{proof}
    $F_i$ and $F_{i+1}$ are two faces of the same $d$ dimensional simplex, and thus they share exactly $d-1$ vertices. This means that there is exactly one vertex $x$ which is in $F_i$ but not in $F_{i+1}$, and exactly one vertex $y$ which is in $F_{i+1}$ but not in $F_i$. This means that there is exactly one $j$ such that $x_i^j = x$ and $x_{i+1}^j = y$.
\end{proof}
This means that a valid transition sequence can be seen as a sequence of change of the vertex $x_i$ for a given color $j$. Now we are ready to prove the main result of this section, which is the key to showing that a monotone \Tarski\ instance does not contain any cycles. We restrict the setting to the case where $0 \in C$, as vertices colored $0$ play a particular role.
\begin{proposition}
    Let $S_i$, $F_i$ and $x_j$ be as above. For a fixed $j \in C \setminus \{0\}$ we have the following:
    \begin{enumerate}
        \item If for some $i^* \in \set{1, \dots, k-1}$ we have $x_{i^*}^j[j] < x_{i^*}^0[j]$, then for all $i \in \set{1, \dots, k-1}$ we have $x_i^j\leq x_i^0$.
        \item If for some $i^* \in \set{1, \dots, k-1}$ we have $x_{i^*}^j[j] > x_{i^*}^0[j]$, then for all $i \in \set{1, \dots, k-1}$ we have $x_i^j\geq x_i^0$.
    \end{enumerate}
\end{proposition}